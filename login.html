<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<base target="_top" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Portal de Compras</title>
		<!-- Tailwind CSS para um design moderno e responsivo -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- Font Awesome para ícones -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
		<!-- Chart.js para gráficos -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Biblioteca Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
  <?!= include('Stylesheet'); ?>
	</head>
	<body>
		<!-- Container para toasts/notificações -->
		<div id="toast-container" class="toast-container"></div>
    <!-- ================================================================= -->
		<!-- 1. MODAL DE CALCULO IMPOSTO      -->
		<!-- ================================================================= -->
    <div id="modalCalculoSt" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 modal-hidden">
    <div class="modal-overlay"></div>

    <div class="modal-content transform transition-all sm:max-w-xs sm:w-full">
        <div class="bg-white p-5 rounded-lg shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Cálculo Rápido de Imposto</h3>
                <button class="modal-close-btn text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="valorProdutoSt" class="block text-sm font-medium text-gray-700">Valor do Produto (R$):</label>
                    <input type="number" id="valorProdutoSt" placeholder="Ex: 1500.00" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="selectEstadoSt" class="block text-sm font-medium text-gray-700">Estado de Origem:</label>
                    <select id="selectEstadoSt" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <button id="btnCalcularSt" class="w-full text-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 flex items-center justify-center">
                    <i class="fas fa-play mr-2"></i>
                    <span>Calcular</span>
                </button>
            </div>

            <div id="resultadoSt" class="mt-4 pt-4 border-t border-gray-200 min-h-[50px]">
                </div>
        </div>
    </div>
</div>


    <!-- ================================================================= -->
		<!-- 1. MODAL DE REJEICAO             -->
		<!-- ================================================================= -->
    <div id="rejection-reason-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
      <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
          <h3 class="text-lg leading-6 font-medium text-gray-900">Motivo da Rejeição</h3>
          <div class="mt-2 px-7 py-3">
            <p class="text-sm text-gray-500 mb-4">Por favor, descreva por que este pedido está a ser rejeitado.</p>
            <textarea id="rejection-reason-textarea" rows="4" class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Valor do item X acima do combinado..."></textarea>
          </div>
          <div class="items-center px-4 py-3 space-x-2">
            <button id="cancel-rejection-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancelar</button>
            <button id="confirm-rejection-btn" class="px-4 py-2 bg-red-600 text-white rounded-md shadow-md hover:bg-red-700">Confirmar Rejeição</button>
          </div>
        </div>
      </div>
    </div>
		<!-- ================================================================= -->
		<!-- 1. MODAL DE CONFIRMAÇÃO             -->
		<!-- ================================================================= -->
		<div id="modal-cancelar-pedido-container" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-hidden modal-container">
			<div class="absolute inset-0 bg-black/60 modal-overlay"></div>
			<div class="relative w-full max-w-md bg-white rounded-2xl shadow-xl modal-panel">
				<div class="p-6 text-center">
					<div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
						<i class="fas fa-exclamation-triangle text-2xl text-red-600"></i>
					</div>
					<h3 class="text-xl font-bold text-gray-800 mt-5" id="modal-cancelar-title">Cancelar Pedido</h3>
					<p id="modal-cancelar-mensagem" class="mt-2 text-sm text-gray-500">Você tem certeza que deseja cancelar este pedido? Esta ação não pode ser desfeita.</p>
				</div>
				<div class="flex justify-center gap-4 p-4 bg-gray-50 rounded-b-2xl">
					<button class="modal-cancel-btn px-5 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">Manter Pedido</button>
					<button id="modal-confirmar-cancelamento-btn" class="px-5 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700">Sim, Cancelar</button>
				</div>
			</div>
		</div>

		<!-- ================================================================= -->
		<!-- 1. HTML DO MODAL DE GERENCIAMENTO DE AVISOS                     -->
		<!-- Adicione este bloco ao seu arquivo HTML principal, junto com     -->
		<!-- os outros modais.                                               -->
		<!-- ================================================================= -->
		<div id="modal-gerenciar-avisos-container" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-hidden modal-container">
			<div class="absolute inset-0 bg-black/60 modal-overlay"></div>
			<div class="relative w-full max-w-2xl bg-white rounded-2xl shadow-xl modal-panel flex flex-col">
				<!-- Cabeçalho do Modal -->
				<div class="p-6 border-b">
					<div class="flex items-start justify-between">
						<h3 class="text-xl font-bold text-gray-800">Gerenciar Mural de Avisos</h3>
						<button class="modal-close-btn text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
					</div>
				</div>

				<!-- Corpo do Modal -->
				<div class="p-6 space-y-6 overflow-y-auto" style="max-height: 70vh;">
					<!-- Formulário para Adicionar/Editar Aviso -->
					<div class="p-4 border border-gray-200 rounded-lg">
						<h4 id="form-aviso-titulo" class="text-lg font-semibold text-gray-700 mb-4">Adicionar Novo Aviso</h4>
						<form id="form-novo-aviso" class="space-y-4">
							<input type="hidden" id="aviso-id-input" />
							<div>
								<label for="aviso-titulo-input" class="block text-sm font-medium text-gray-700">Título</label>
								<input type="text" id="aviso-titulo-input" placeholder="Ex: Manutenção Programada" class="mt-1 block w-full input-style" />
							</div>
							<div>
								<label for="aviso-mensagem-input" class="block text-sm font-medium text-gray-700">Mensagem</label>
								<textarea id="aviso-mensagem-input" rows="3" placeholder="Descreva o aviso aqui..." class="mt-1 block w-full input-style"></textarea>
							</div>
							<div>
								<label for="aviso-vencimento-input" class="block text-sm font-medium text-gray-700">Data de Vencimento (Opcional)</label>
								<input type="date" id="aviso-vencimento-input" class="mt-1 block w-full input-style" />
								<p class="mt-1 text-xs text-gray-500">O aviso será ocultado automaticamente após esta data. Deixe em branco para não expirar.</p>
							</div>
							<div class="flex justify-end gap-2">
								<button type="button" id="cancelar-edicao-aviso-btn" class="hidden px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Cancelar Edição</button>
								<button type="submit" id="salvar-aviso-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Salvar Aviso</button>
							</div>
						</form>
					</div>

					<!-- Lista de Avisos Atuais -->
					<div>
						<h4 class="text-lg font-semibold text-gray-700 mb-4">Avisos Atuais</h4>
						<div id="lista-avisos-gerenciamento" class="space-y-2">
							<p class="text-center text-gray-500">Carregando avisos...</p>
						</div>
					</div>
				</div>

				<!-- Rodapé do Modal -->
				<div class="flex justify-end p-4 bg-gray-50 rounded-b-2xl">
					<button class="modal-cancel-btn px-5 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">Fechar</button>
				</div>
			</div>
		</div>

      <!-- MODAL DE VEICULOS -->
			<div id="modal-veiculo" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center">
				<div id="modal-veiculo-overlay" class="absolute inset-0"></div>

				<div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
					<div class="mt-3 text-center">
						<h3 class="text-lg leading-6 font-medium text-gray-900">Adicionar Novo Veículo</h3>

						<div class="mt-4 px-7 py-3">
							<label for="nome-veiculo-input" class="sr-only">Modelo do Veículo</label>
							<input
								type="text"
								id="nome-veiculo-input"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
								placeholder="Digite o Modelo"
							/>
						</div>

						<div class="items-center px-4 py-3 space-x-4">
							<button id="modal-cancelar-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md text-base font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
								Cancelar
							</button>
							<button id="modal-salvar-veiculo-btn" class="px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
								Salvar
							</button>
						</div>
					</div>
				</div>
			</div>

      <!-- MODAL DE REDEFINIÇÃO DE SENHA -->
			<div id="modalRedefinirSenha" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
				<div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 space-y-4">
					<h3 class="text-xl font-bold text-gray-800 text-center">Redefinir senha de <span id="modalUsuario" class="text-blue-600"></span></h3>
					<input id="novaSenhaInput" type="password" placeholder="Nova senha" class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg" />
					<p id="modalSenhaMsg" class="text-center text-sm font-medium min-h-[20px]"></p>
					<div class="flex space-x-4">
						<button onclick="fecharModalRedefinirSenha()" class="w-full py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600">Cancelar</button>
						<button onclick="confirmarRedefinirSenha()" class="w-full py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Confirmar</button>
					</div>
				</div>
			</div>

      <!-- Modal Admin Redefinir Senha -->
      <div id="modal-reset-password-container" class="modal-container modal-hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">     
      <div class="modal-overlay absolute inset-0"></div>
      <div class="relative bg-white rounded-lg shadow-xl w-full max-w-md p-6 mx-4">      
        <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b">
          <h3 id="modal-reset-password-title" class="text-xl font-semibold text-gray-900">
            Redefinir Senha
          </h3>
          <button type="button" class="modal-close-btn text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
          </button>
        </div>
        <div class="space-y-4">
          <p id="reset-password-username" class="text-center text-gray-600">Usuário: ...</p>
          <div>
            <label for="reset-password-input" class="block mb-2 text-sm font-medium text-gray-900">Nova Senha</label>
            <input type="password" id="reset-password-input" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5" placeholder="Digite a nova senha aqui" required>
          </div>
        </div>
        <div class="flex items-center justify-end pt-6 mt-6 space-x-2 border-t border-gray-200 rounded-b">
          <button id="modal-reset-password-cancel-btn" type="button" class="modal-cancel-btn px-5 py-2.5 text-sm font-medium text-gray-900 bg-white rounded-lg border border-gray-200 hover:bg-gray-100 focus:outline-none">Cancelar</button>
          <button id="modal-reset-password-save-btn" data-userid="" type="button" class="px-5 py-2.5 text-sm font-medium text-center text-white bg-purple-600 rounded-lg hover:bg-purple-700 focus:ring-4 focus:outline-none focus:ring-purple-300">Salvar Nova Senha</button>
        </div>
      </div>
    </div>

		<!-- O container principal da nossa aplicação de página única -->
		<div id="app">
			<!-- =============================================== -->
			<!-- TELA DE LOGIN                                   -->
			<!-- =============================================== -->
			<div id="screen-login" class="screen active">
				<div class="min-h-screen flex items-center justify-center p-4">
					<div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 space-y-6">
						<div class="text-center">
							<h2 class="text-3xl font-bold text-gray-800">Portal de Compras</h2>
							<p class="text-gray-500 mt-2">Faça login para entrar</p>
						</div>
						<div class="space-y-4">
							<input type="text" id="username" placeholder="Usuário" required autofocus class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
							<input type="password" id="password" placeholder="Senha" required class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
							<select id="selectEmpresaLogin" required class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
								<option value="">Primeiro, digite o usuário</option>
							</select>
						</div>
						<button id="loginButton" class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">Entrar</button>
						<p id="message-login" class="text-center text-sm font-medium min-h-[20px]"></p>
						<div class="text-center">
							<button class="text-sm text-blue-600 hover:underline" id="createAccountButton">Criar Conta</button>
						</div>
					</div>
				</div>
			</div>

			<!-- =============================================== -->
			<!-- TELA DE CADASTRO DE USUÁRIO                     -->
			<!-- =============================================== -->
			<!--->      <!-- Container Principal da Página de Solicitação de Cadastro -->
			<div id="screen-cadastro" class="screen">
				<div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 space-y-6">
					<!-- Cabeçalho -->
					<div class="text-center">
						<h2 class="text-3xl font-bold text-gray-800">Criar Nova Conta</h2>
						<p class="mt-2 text-sm text-gray-600">Sua solicitação será enviada para aprovação.</p>
					</div>

					<!-- Mensagem de erro/sucesso -->
					<p id="message-cadastro" class="text-center text-sm font-medium min-h-[20px]"></p>

					<!-- Formulário -->
					<form class="space-y-4" onsubmit="return false;">
						<div>
							<label for="name" class="block text-sm font-medium text-gray-700">Nome Completo</label>
							<input id="name" name="name" type="text" required class="mt-1 block w-full input-style uppercase" placeholder="Seu nome completo" />
						</div>

						<div>
							<label for="username-cadastro" class="block text-sm font-medium text-gray-700">Usuário</label>
							<input id="username-cadastro" name="username-cadastro" type="text" required class="mt-1 block w-full input-style bg-gray-100 cursor-not-allowed" placeholder="Nome do Usuário" readonly />
						</div>

						<div>
							<label for="password-cadastro" class="block text-sm font-medium text-gray-700">Senha</label>
							<input id="password-cadastro" name="password-cadastro" type="password" required minlength="6" class="mt-1 block w-full input-style" placeholder="Mínimo de 6 caracteres" />
						</div>

						<!-- Botão de Ação -->
						<div>
							<button
								id="registerButton"
								type="button"
								class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
							>
								Solicitar Cadastro
							</button>
						</div>
					</form>

					<!-- Link para Voltar -->
					<div class="text-center">
						<button id="backToLoginButton" class="text-sm font-medium text-gray-600 hover:text-blue-500">
							Já tem uma conta? Voltar ao Login
						</button>
					</div>
				</div>
			</div>

			<!-- Estilos genéricos para os inputs, para não poluir o HTML -->
			<style>
				.input-style {
				    padding: 0.75rem;
				    border: 1px solid #D1D5DB; /* gray-300 */
				    border-radius: 0.5rem; /* rounded-lg */
				    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
				    transition: border-color 0.2s, box-shadow 0.2s;
				}
				.input-style:focus {
				    outline: none;
				    border-color: #3B82F6; /* blue-500 */
				    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); /* ring-blue-500 */
				}
			</style>

			<!-- Modal de Empresas -->
			<!--->        <div id="modal-empresas-container" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-hidden modal-container">
              <div class="absolute inset-0 bg-black/60 modal-overlay"></div>
              <div class="relative w-full max-w-lg bg-white rounded-2xl shadow-xl modal-panel">
                  <div class="p-6">
                      <div class="flex items-start justify-between">
                          <h3 class="text-xl font-bold text-gray-800" id="modal-empresas-title"></h3>
                          <button class="modal-close-btn text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
                      </div>
                      <div class="mt-6 max-h-72 overflow-y-auto pr-2">
                          <table class="min-w-full">
                              <thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acesso</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Empresa</th><th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Padrão</th></tr></thead>
                              <tbody id="empresas-list-body"></tbody>
                          </table>
                      </div>
                  </div>
                  <div class="flex justify-end gap-4 p-4 bg-gray-50 rounded-b-2xl"><button class="modal-cancel-btn px-5 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">Cancelar</button><button id="modal-empresas-save-btn" class="px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Salvar</button></div>
              </div>
          </div>
          
          <!-- Modal de Auditoria -->
			<!--->        <div id="modal-audit-container" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-hidden modal-container">
              <div class="absolute inset-0 bg-black/60 modal-overlay"></div>
              <div class="relative w-full max-w-lg bg-white rounded-2xl shadow-xl modal-panel">
                  <div class="p-6">
                      <div class="flex items-start justify-between">
                          <h3 class="text-xl font-bold text-gray-800" id="modal-audit-title"></h3>
                          <button class="modal-close-btn text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
                      </div>
                      <div id="modal-audit-body" class="mt-6 space-y-4"></div>
                  </div>
                  <div class="flex justify-end gap-4 p-4 bg-gray-50 rounded-b-2xl"><button class="modal-cancel-btn px-5 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100">Fechar</button></div>
              </div>
          </div>
         

        <!-- =============================================== -->
			<!-- TELA PRINCIPAL (após o login)                   -->
			<!-- =============================================== -->
			<div id="screen-main" class="screen">
				<!-- Barra de Navegação Superior -->
				<nav class="bg-white shadow-md sticky top-0 z-40">
					<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
						<div class="flex items-center justify-between h-16">
							<div class="flex items-center">
								<span class="text-2xl font-bold text-blue-600">Portal de Compras</span>
								<div id="empresaInfo" class="ml-6 hidden md:block text-sm text-gray-600 border-l-2 border-gray-200 pl-4"></div>
							</div>
							<div class="flex items-center">
								<div class="welcome-message text-sm text-gray-700 mr-4 hidden sm:block">Olá, <span id="nome" class="font-semibold"></span> (<span id="perfil"></span>)</div>
								<button id="logoutButton" class="flex items-center px-3 py-2 bg-red-500 text-white text-sm font-medium rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
									<i class="fas fa-sign-out-alt mr-2"></i>Sair
								</button>
							</div>
						</div>
					</div>
				</nav>

				<!-- Área de Conteúdo Principal -->
				<main id="main-content-area" class="p-4 sm:p-6 lg:p-8">
					<!-- O conteúdo das outras "telas" será injetado aqui -->
				</main>
			</div>

			<!-- MODAL GLOBAL DE AVISOS (para substituir alerts) -->
			<div id="global-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center p-4 z-50">
				<div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 text-center space-y-4">
					<h3 id="modal-title" class="text-xl font-bold text-gray-800">Aviso</h3>
					<p id="modal-message" class="text-gray-600">Sua mensagem aparecerá aqui.</p>
					<button id="modal-close-btn" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">OK</button>
				</div>
			</div>

			<!-- TODO O SEU JAVASCRIPT, ADAPTADO PARA O MODELO SPA -->
			<?!= include('JavaScript'); ?>
		</div>
	</body>
</html>
